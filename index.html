<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portal de Usuario</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins :wght@400;600&display=swap" />
  <style>
    /* ... Tus estilos actuales aquí ... */

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #e0e0e0;
      overflow: hidden;
      position: relative;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .cloud-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 200%;
      height: 100%;
      background: linear-gradient(to bottom, #a0c0e0, #c0d0e0);
      animation: moveClouds 60s linear infinite;
      z-index: -2;
    }

    @keyframes moveClouds {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .page-container {
      max-width: 600px;
      width: 90%;
      margin: 50px auto;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      z-index: 1;
      position: relative;
      transition: transform 0.3s ease-in-out;
      display: none;
      box-sizing: border-box;
    }

    .page-container:hover {
      transform: translateY(-5px);
    }

    button {
      background-color: rgba(100, 149, 237, 0.7);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 1em;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      display: block;
      width: 100%;
      margin-top: 20px;
    }

    button:hover {
      background-color: rgba(70, 130, 180, 0.8);
      transform: scale(1.02) translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .profile-info p {
      margin-bottom: 10px;
      color: #555;
      padding: 8px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 5px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .modal-content h3 {
      margin-bottom: 10px;
    }

    .modal-content input,
    .modal-content select,
    .modal-content textarea,
    .modal-content button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .modal-content button {
      margin-top: 20px;
      background-color: #4682b4;
      color: white;
      border: none;
    }

    .modal-content button:hover {
      background-color: #36648B;
    }
  </style>
</head>
<body>

<!-- Fondo animado -->
<div class="cloud-background"></div>

<!-- Contenedores -->
<div id="login-page" class="page-container">
  <h2>Iniciar Sesión</h2>
  <div class="form-group">
    <label for="email">Correo Electrónico:</label>
    <input type="email" id="email" placeholder="Ingresa tu correo" />
  </div>
  <div class="form-group">
    <label for="password">Contraseña:</label>
    <input type="password" id="password" placeholder="Ingresa tu contraseña" />
  </div>
  <button id="login-button">Entrar</button>
</div>

<div id="profile-page" class="page-container">
  <h2>Mi Perfil</h2>
  <div class="profile-info">
    <p><strong>Nombre Completo:</strong> Ruth Pérez</p>
    <p><strong>RUT:</strong> 12.345.678-9</p>
    <p><strong>Dirección:</strong> Calle Falsa 123, Santiago</p>
    <p><strong>Teléfono:</strong> +56 9 1234 5678</p>
    <p><strong>Correo:</strong> ruth.perez@example.com</p>
  </div>
  <button id="request-permission-button">Pedir Permiso</button>
  <button id="manage-permissions-button">Gestionar Permisos y Feriados</button>
  <button onclick="showPage(loginPage)" style="margin-top: 10px;">⬅️ Atrás</button>
</div>

<div id="calendar-page" class="page-container">
  <div class="calendar-header">
    <div class="nav-buttons">
      <button id="prevMonth">Anterior</button>
      <button id="nextMonth">Siguiente</button>
    </div>
    <h2 id="currentMonthYear"></h2>
  </div>
  <div class="calendar-grid"></div>
  <button id="back-to-profile-button" class="back-button">Volver al Perfil</button>
</div>

<!-- Modal para pedir permiso -->
<div class="modal" id="permission-modal">
  <div class="modal-content">
    <h3>Solicitar Permiso</h3>
    <select id="type-select">
      <option value="Administrativo">Permiso Administrativo</option>
      <option value="Enfermedad">Licencia Médica</option>
      <option value="Matrimonio">Permiso por Matrimonio</option>
      <option value="Feriado">Feriado</option>
    </select>
    <input type="date" id="start-date" placeholder="Fecha de inicio" />
    <input type="date" id="end-date" placeholder="Fecha de término" />
    <textarea id="reason" rows="3" placeholder="Motivo del permiso..."></textarea>
    <button onclick="generatePDF()">Descargar PDF</button>
    <button onclick="closeModal()">Cerrar</button>
  </div>
</div>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>

<script>
  const loginPage = document.getElementById('login-page');
  const profilePage = document.getElementById('profile-page');
  const calendarPage = document.getElementById('calendar-page');

  const requestPermissionButton = document.getElementById('request-permission-button');
  const permissionModal = document.getElementById('permission-modal');

  const loginButton = document.getElementById('login-button');

  function showPage(pageElement) {
    [loginPage, profilePage, calendarPage].forEach(p => p.style.display = 'none');
    pageElement.style.display = 'block';
    if (pageElement === calendarPage) renderCalendar(new Date());
  }

  loginButton.addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    if (email && password) showPage(profilePage);
    else alert('Por favor, ingresa tu correo y contraseña.');
  });

  requestPermissionButton.addEventListener('click', () => {
    permissionModal.style.display = 'flex';
  });

  function closeModal() {
    permissionModal.style.display = 'none';
  }

  async function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const type = document.getElementById('type-select').value;
    const startDate = document.getElementById('start-date').value;
    const endDate = document.getElementById('end-date').value;
    const reason = document.getElementById('reason').value;

    // Datos del usuario
    const nombre = "Ruth Pérez";
    const rut = "12.345.678-9";

    // Formato de fechas
    const formatDate = (dateStr) => {
      const [y, m, d] = dateStr.split('-');
      return `${d}/${m}/${y}`;
    };

    // Fecha actual
    const today = new Date();
    const formattedToday = today.toLocaleDateString("es-CL");

    // Configurar el documento PDF
    doc.setFontSize(12);

    // Encabezado
    doc.text(`Santiago, ${formattedToday}`, 20, 30);
    doc.setFontSize(14);
    doc.text(`Solicitud de ${type}`, 20, 50);
    doc.setFontSize(12);
    doc.text(`De: ${nombre} | RUT: ${rut}`, 20, 70);
    doc.text(`Asunto: Solicitud de Permiso`, 20, 80);
    doc.text(`Fecha: ${formattedToday}`, 20, 90);

    // Cuerpo
    doc.setFontSize(12);
    doc.text("Estimados/as:", 20, 110);
    doc.text("Me dirijo a usted con la finalidad de solicitar un permiso de:", 20, 120);
    doc.text(`Tipo: ${type}`, 20, 130);
    doc.text(`Desde: ${startDate ? formatDate(startDate) : '-'}`, 20, 140);
    doc.text(`Hasta: ${endDate ? formatDate(endDate) : '-'}`, 20, 150);
    doc.text("Con el siguiente motivo:", 20, 160);
    const splitReason = doc.splitTextToSize(reason, 170);
    doc.text(splitReason, 20, 170);

    // Pie de firma
    const startY = Math.max(180 + splitReason.length * 5, 200);
    doc.text("Atentamente,", 20, startY);
    doc.text("_________________", 20, startY + 10);
    doc.text(nombre, 20, startY + 15);
    doc.text(rut, 20, startY + 25);

    // Guardar PDF
    doc.save(`solicitud_${type.toLowerCase().replace(/\s+/g, '_')}.pdf`);
    closeModal();
  }

  // Botones de navegación
  document.getElementById('manage-permissions-button').addEventListener('click', () => showPage(calendarPage));
  document.getElementById('back-to-profile-button').addEventListener('click', () => showPage(profilePage));

  // Mostrar login al cargar
  showPage(loginPage);
</script>
</body>
</html>
