<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portal de Usuario</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins :wght@400;600&display=swap" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #e0e0e0;
      overflow: hidden;
      position: relative;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .cloud-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 200%;
      height: 100%;
      background: linear-gradient(to bottom, #a0c0e0, #c0d0e0);
      animation: moveClouds 60s linear infinite;
      z-index: -2;
    }
    @keyframes moveClouds {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    .cloud-background::before,
    .cloud-background::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://placehold.co/1200x800/c0d0e0/c0d0e0?text= ');
      background-size: cover;
      opacity: 0.6;
    }
    .cloud-background::after {
      left: 100%;
      animation: moveCloudsLayer2 60s linear infinite;
    }
    @keyframes moveCloudsLayer2 {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    .page-container {
      max-width: 600px;
      width: 90%;
      margin: 50px auto;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      z-index: 1;
      position: relative;
      transition: transform 0.3s ease-in-out;
      display: none;
      box-sizing: border-box;
    }
    .page-container:hover {
      transform: translateY(-5px);
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #555;
    }
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      background-color: rgba(255, 255, 255, 0.4);
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
      color: #333;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }
    .form-group input::placeholder {
      color: rgba(51, 51, 51, 0.7);
    }
    button {
      background-color: rgba(100, 149, 237, 0.7);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 1em;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      display: block;
      width: 100%;
      margin-top: 20px;
    }
    button:hover {
      background-color: rgba(70, 130, 180, 0.8);
      transform: scale(1.02) translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    #profile-page h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .profile-info p {
      margin-bottom: 10px;
      color: #555;
      padding: 8px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 5px;
    }
    .profile-info strong {
      color: #333;
    }
    #calendar-page .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 0 10px;
    }
    #calendar-page .calendar-header h2 {
      margin: 0;
      font-size: 1.5em;
      color: #333;
    }
    #calendar-page .calendar-header .nav-buttons {
      display: flex;
      gap: 10px;
    }
    #calendar-page .back-button {
      background-color: rgba(150, 150, 150, 0.7);
      margin-top: 20px;
      width: auto;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    #calendar-page .back-button:hover {
      background-color: rgba(120, 120, 120, 0.8);
    }
    #calendar-page .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      text-align: center;
    }
    #calendar-page .day-name {
      font-weight: bold;
      color: #555;
      padding: 10px 0;
    }
    #calendar-page .day {
      padding: 10px 5px;
      border-radius: 8px;
      background-color: rgba(255, 255, 255, 0.4);
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      position: relative;
      overflow: hidden;
      color: #333;
    }
    #calendar-page .day:hover {
      background-color: rgba(255, 255, 255, 0.6);
      transform: scale(1.05);
    }
    #calendar-page .day.other-month {
      opacity: 0.5;
      pointer-events: none;
    }
    #calendar-page .day.today {
      font-weight: bold;
      border: 2px solid rgba(255, 99, 71, 0.7);
    }
    #calendar-page .day.selected {
      background-color: rgba(255, 165, 0, 0.7);
      color: white;
      font-weight: bold;
    }
    #calendar-page .day.holiday {
      background-color: rgba(255, 69, 0, 0.6);
      color: white;
      font-weight: bold;
    }
    #calendar-page .day.leave {
      background-color: rgba(0, 128, 0, 0.6);
      color: white;
      font-weight: bold;
    }
    #calendar-page .day .event-indicator {
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.6em;
      color: rgba(255, 255, 255, 0.8);
    }
    #calendar-page .day.holiday .event-indicator {
      color: rgba(255, 255, 255, 0.9);
    }
    @media (max-width: 768px) {
      .page-container {
        padding: 20px;
      }
      #calendar-page .calendar-header h2 {
        font-size: 1.2em;
      }
      #calendar-page .calendar-header button {
        padding: 6px 10px;
        font-size: 0.9em;
      }
      #calendar-page .day {
        padding: 8px 3px;
        font-size: 0.9em;
      }
    }
    /* Estilo para el modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .modal-content h3 {
      margin-bottom: 10px;
    }
    .modal-content select,
    .modal-content button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      font-size: 1em;
    }
  </style>
</head>
<body>

  <!-- Fondo animado -->
  <div class="cloud-background"></div>

  <!-- Contenedores -->
  <div id="login-page" class="page-container">
    <h2>Iniciar Sesión</h2>
    <div class="form-group">
      <label for="email">Correo Electrónico:</label>
      <input type="email" id="email" placeholder="Ingresa tu correo" />
    </div>
    <div class="form-group">
      <label for="password">Contraseña:</label>
      <input type="password" id="password" placeholder="Ingresa tu contraseña" />
    </div>
    <button id="login-button">Entrar</button>
  </div>

  <div id="profile-page" class="page-container">
    <h2>Mi Perfil</h2>
    <div class="profile-info">
      <p><strong>Nombre Completo:</strong> Ruth Pérez</p>
      <p><strong>RUT:</strong> 12.345.678-9</p>
      <p><strong>Dirección:</strong> Calle Falsa 123, Santiago</p>
      <p><strong>Teléfono:</strong> +56 9 1234 5678</p>
      <p><strong>Correo:</strong> ruth.perez@example.com</p>
    </div>
    <button id="manage-permissions-button">Gestionar Permisos y Feriados</button>
    <button onclick="showPage(loginPage)" style="margin-top: 10px;">⬅️ Atrás</button>
  </div>

  <div id="calendar-page" class="page-container">
    <div class="calendar-header">
      <div class="nav-buttons">
        <button id="prevMonth">Anterior</button>
        <button id="nextMonth">Siguiente</button>
      </div>
      <h2 id="currentMonthYear"></h2>
    </div>
    <div class="calendar-grid"></div>
    <!-- Botón nuevo: Confirmar Selección -->
    <button id="confirm-selection" class="back-button" style="display: none;">Confirmar Selección</button>
    <button id="back-to-profile-button" class="back-button">Volver al Perfil</button>
  </div>

  <!-- Modal para solicitar permiso -->
  <div class="modal" id="request-modal">
    <div class="modal-content">
      <h3>Seleccionaste <span id="selected-days-count">0</span> día(s)</h3>
      <select id="leave-type">
        <option value="admin">Permiso Administrativo</option>
        <option value="sick">Licencia Médica</option>
        <option value="marriage">Permiso por Matrimonio</option>
        <option value="holiday">Feriado</option>
      </select>
      <button onclick="generatePDF()">Descargar PDF</button>
      <button onclick="closeModal()">Cerrar</button>
    </div>
  </div>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>

<script>
    const loginPage = document.getElementById('login-page');
    const profilePage = document.getElementById('profile-page');
    const calendarPage = document.getElementById('calendar-page');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginButton = document.getElementById('login-button');
    const managePermissionsButton = document.getElementById('manage-permissions-button');
    const backToProfileButton = document.getElementById('back-to-profile-button');

    const calendarGrid = document.querySelector('#calendar-page .calendar-grid');
    const currentMonthYear = document.getElementById('currentMonthYear');
    const prevMonthButton = document.getElementById('prevMonth');
    const nextMonthButton = document.getElementById('nextMonth');

    const modal = document.getElementById('request-modal');
    const selectedDaysCount = document.getElementById('selected-days-count');
    const leaveTypeSelect = document.getElementById('leave-type');

    let currentDate = new Date();
    let selectedDays = [];

    const chileanHolidays = [
        { month: 0, day: 1, name: "Año Nuevo" },
        { month: 3, day: 18, name: "Viernes Santo" },
        { month: 3, day: 19, name: "Sábado Santo" },
        { month: 4, day: 1, name: "Día del Trabajador" },
        { month: 4, day: 21, name: "Día de las Glorias Navales" },
        { month: 5, day: 26, name: "San Pedro y San Pablo" },
        { month: 6, day: 16, name: "Virgen del Carmen" },
        { month: 7, day: 15, name: "Asunción de la Virgen" },
        { month: 8, day: 18, name: "Independencia Nacional" },
        { month: 8, day: 19, name: "Día de las Glorias del Ejército" },
        { month: 9, day: 31, name: "Día Nacional de las Iglesias Evangélicas y Protestantes" },
        { month: 10, day: 1, name: "Día de Todos los Santos" },
        { month: 11, day: 8, name: "Inmaculada Concepción" },
        { month: 11, day: 25, name: "Navidad" }
    ];

    function showPage(pageElement) {
        [loginPage, profilePage, calendarPage].forEach(p => p.style.display = 'none');
        pageElement.style.display = 'block';
        if (pageElement === calendarPage) renderCalendar(currentDate);
    }

    loginButton.addEventListener('click', () => {
        const email = emailInput.value;
        const password = passwordInput.value;
        if (email && password) showPage(profilePage);
        else alert('Por favor, ingresa tu correo y contraseña.');
    });

    managePermissionsButton.addEventListener('click', () => showPage(calendarPage));
    backToProfileButton.addEventListener('click', () => showPage(profilePage));

    prevMonthButton.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });

    nextMonthButton.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });

    function renderCalendar(date) {
        calendarGrid.innerHTML = '';
        const dayNames = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];
        dayNames.forEach(name => {
            const div = document.createElement('div');
            div.classList.add('day-name');
            div.textContent = name;
            calendarGrid.appendChild(div);
        });

        const year = date.getFullYear();
        const month = date.getMonth();
        currentMonthYear.textContent = new Intl.DateTimeFormat('es-CL', { month: 'long', year: 'numeric' }).format(date);

        const firstDayOfMonth = new Date(year, month, 1);
        const lastDayOfMonth = new Date(year, month + 1, 0);
        const numDaysInMonth = lastDayOfMonth.getDate();

        let firstDayOfWeek = firstDayOfMonth.getDay();
        firstDayOfWeek = (firstDayOfWeek === 0) ? 6 : firstDayOfWeek - 1;

        const prevMonthLastDay = new Date(year, month, 0).getDate();
        for (let i = firstDayOfWeek; i > 0; i--) {
            const div = document.createElement('div');
            div.classList.add('day', 'other-month');
            div.textContent = prevMonthLastDay - i + 1;
            calendarGrid.appendChild(div);
        }

        for (let i = 1; i <= numDaysInMonth; i++) {
            const div = document.createElement('div');
            div.classList.add('day');
            div.textContent = i;
            const currentDay = new Date(year, month, i);

            if (currentDay.toDateString() === new Date().toDateString()) {
                div.classList.add('today');
            }

            const isHoliday = chileanHolidays.some(holiday =>
                holiday.month === month && holiday.day === i
            );
            if (isHoliday) {
                div.classList.add('holiday');
                const indicator = document.createElement('span');
                indicator.classList.add('event-indicator');
                indicator.textContent = 'Feriado';
                div.appendChild(indicator);
            }

            div.addEventListener('click', () => {
                div.classList.toggle('selected');
                updateSelectedDays();
            });

            calendarGrid.appendChild(div);
        }

        const totalDaysDisplayed = firstDayOfWeek + numDaysInMonth;
        const remainingDays = 42 - totalDaysDisplayed;
        for (let i = 1; i <= remainingDays; i++) {
            if (totalDaysDisplayed + i > 35 && totalDaysDisplayed + i <= 42) {
                const div = document.createElement('div');
                div.classList.add('day', 'other-month');
                div.textContent = i;
                calendarGrid.appendChild(div);
            }
        }
    }

    function updateSelectedDays() {
        selectedDays = Array.from(document.querySelectorAll('.day.selected')).map(d => parseInt(d.textContent));
        if (selectedDays.length > 0) openModal();
    }

    function openModal() {
        selectedDaysCount.textContent = selectedDays.length;
        modal.style.display = 'flex';
    }

    function closeModal() {
        modal.style.display = 'none';
    }

    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Datos del usuario
        const nombre = "Ruth Pérez";
        const rut = "12.345.678-9";

        // Tipo de permiso
        const tipoPermiso = leaveTypeSelect.options[leaveTypeSelect.selectedIndex].text;

        // Fechas seleccionadas
        const diasOrdenados = [...selectedDays].sort((a, b) => a - b);
        const mesActual = new Date(currentDate).toLocaleString("es-ES", { month: "long" });
        const añoActual = currentDate.getFullYear();

        const fechaInicio = `${diasOrdenados[0]} de ${mesActual} de ${añoActual}`;
        const fechaFin = `${diasOrdenados[diasOrdenados.length - 1]} de ${mesActual} de ${añoActual}`;

        const fechaHoy = new Date().toLocaleDateString("es-CL");

        // Título del documento
        doc.setFontSize(14);
        doc.setFont(undefined, "bold");
        doc.text(`Solicitud de ${tipoPermiso}`, doc.internal.pageSize.getWidth() / 2, 30, { align: "center" });

        // Cuerpo del oficio
        doc.setFontSize(12);
        doc.setFont(undefined, "normal");
        const cuerpoOficio = `
Se solicita tener a bien aprobar mi día de ${tipoPermiso.toLowerCase()} correspondiente al periodo comprendido entre el ${fechaInicio} y el ${fechaFin}.
            
Desde ya muchas gracias.`;

        const lines = doc.splitTextToSize(cuerpoOficio, 170);
        let startY = 40;

        lines.forEach(line => {
            doc.text(line, 20, startY);
            startY += 10;
        });

        // Fecha
        startY += 20;
        doc.text(`Santiago, ${fechaHoy}`, doc.internal.pageSize.getWidth() - 20, startY, { align: "right" });

        // Saludo final
        startY += 10;
        doc.text("Saludos cordiales,", 20, startY);

        // Nombre y RUT
        startY += 20;
        doc.text(nombre, 20, startY);
        doc.text(rut, 20, startY + 10);

        // Línea para firma
        const firmaY = startY + 25;
        doc.line(20, firmaY, 80, firmaY); // Línea horizontal
        doc.text("_____________________", 20, firmaY + 5);
        doc.text("Firma", 20, firmaY + 15);

        // Guardar el PDF
        doc.save(`solicitud_${tipoPermiso.toLowerCase().replace(/\s+/g, '_')}.pdf`);
        closeModal();
    }

    // Mostrar página de login al cargar
    showPage(loginPage);
</script>

</body>
</html>
