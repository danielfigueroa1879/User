<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal de Usuario</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins :wght@400;600&display=swap">
  <style>
    /* ... [Mismo estilo que antes] ... */
    /* Estilo para el modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .modal-content h3 {
      margin-bottom: 10px;
    }
    .modal-content select,
    .modal-content button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      font-size: 1em;
    }
  </style>
</head>
<body>

<!-- Fondo animado -->
<div class="cloud-background"></div>

<!-- Contenedores -->
<div id="login-page" class="page-container">
  <h2>Iniciar Sesión</h2>
  <div class="form-group">
    <label for="email">Correo Electrónico:</label>
    <input type="email" id="email" placeholder="Ingresa tu correo">
  </div>
  <div class="form-group">
    <label for="password">Contraseña:</label>
    <input type="password" id="password" placeholder="Ingresa tu contraseña">
  </div>
  <button id="login-button">Entrar</button>
</div>

<div id="profile-page" class="page-container">
  <h2>Mi Perfil</h2>
  <div class="profile-info">
    <p><strong>Nombre Completo:</strong> Ruth Pérez</p>
    <p><strong>RUT:</strong> 12.345.678-9</p>
    <p><strong>Dirección:</strong> Calle Falsa 123, Santiago</p>
    <p><strong>Teléfono:</strong> +56 9 1234 5678</p>
    <p><strong>Correo:</strong> ruth.perez@example.com</p>
  </div>
  <button id="manage-permissions-button">Gestionar Permisos y Feriados</button>
  <button onclick="showPage(loginPage)" style="margin-top: 10px;">⬅️ Atrás</button>
</div>

<div id="calendar-page" class="page-container">
  <div class="calendar-header">
    <div class="nav-buttons">
      <button id="prevMonth">Anterior</button>
      <button id="nextMonth">Siguiente</button>
    </div>
    <h2 id="currentMonthYear"></h2>
  </div>
  <div class="calendar-grid"></div>
  <button id="back-to-profile-button" class="back-button">Volver al Perfil</button>
</div>

<!-- Modal para solicitar permiso -->
<div class="modal" id="request-modal">
  <div class="modal-content">
    <h3>Seleccionaste <span id="selected-days-count">0</span> día(s)</h3>
    <select id="leave-type">
      <option value="admin">Permiso Administrativo</option>
      <option value="sick">Licencia Médica</option>
      <option value="marriage">Permiso por Matrimonio</option>
      <option value="holiday">Feriado</option>
    </select>
    <button onclick="generatePDF()">Descargar PDF</button>
    <button onclick="closeModal()">Cerrar</button>
  </div>
</div>

<!-- Script principal -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
<script>
  const loginPage = document.getElementById('login-page');
  const profilePage = document.getElementById('profile-page');
  const calendarPage = document.getElementById('calendar-page');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginButton = document.getElementById('login-button');
  const managePermissionsButton = document.getElementById('manage-permissions-button');
  const backToProfileButton = document.getElementById('back-to-profile-button');

  const calendarGrid = document.querySelector('#calendar-page .calendar-grid');
  const currentMonthYear = document.getElementById('currentMonthYear');
  const prevMonthButton = document.getElementById('prevMonth');
  const nextMonthButton = document.getElementById('nextMonth');

  const modal = document.getElementById('request-modal');
  const selectedDaysCount = document.getElementById('selected-days-count');
  const leaveTypeSelect = document.getElementById('leave-type');

  let currentDate = new Date();
  let selectedDays = [];

  const chileanHolidays = [
    { month: 0, day: 1, name: "Año Nuevo" },
    { month: 3, day: 18, name: "Viernes Santo" },
    { month: 3, day: 19, name: "Sábado Santo" },
    { month: 4, day: 1, name: "Día del Trabajador" },
    { month: 4, day: 21, name: "Día de las Glorias Navales" },
    { month: 5, day: 26, name: "San Pedro y San Pablo" },
    { month: 6, day: 16, name: "Virgen del Carmen" },
    { month: 7, day: 15, name: "Asunción de la Virgen" },
    { month: 8, day: 18, name: "Independencia Nacional" },
    { month: 8, day: 19, name: "Día de las Glorias del Ejército" },
    { month: 9, day: 31, name: "Día Nacional de las Iglesias Evangélicas y Protestantes" },
    { month: 10, day: 1, name: "Día de Todos los Santos" },
    { month: 11, day: 8, name: "Inmaculada Concepción" },
    { month: 11, day: 25, name: "Navidad" }
  ];

  function showPage(pageElement) {
    loginPage.style.display = 'none';
    profilePage.style.display = 'none';
    calendarPage.style.display = 'none';
    pageElement.style.display = 'block';

    if (pageElement === calendarPage) {
      renderCalendar(currentDate);
    }
  }

  loginButton.addEventListener('click', () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    if (email && password) {
      showPage(profilePage);
    } else {
      alert('Por favor, ingresa tu correo y contraseña.');
    }
  });

  managePermissionsButton.addEventListener('click', () => {
    showPage(calendarPage);
  });

  backToProfileButton.addEventListener('click', () => {
    showPage(profilePage);
  });

  prevMonthButton.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar(currentDate);
  });

  nextMonthButton.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar(currentDate);
  });

  function renderCalendar(date) {
    calendarGrid.innerHTML = '';
    const dayNames = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];
    dayNames.forEach(name => {
      const div = document.createElement('div');
      div.classList.add('day-name');
      div.textContent = name;
      calendarGrid.appendChild(div);
    });

    const year = date.getFullYear();
    const month = date.getMonth();
    currentMonthYear.textContent = new Intl.DateTimeFormat('es-CL', { month: 'long', year: 'numeric' }).format(date);

    const firstDayOfMonth = new Date(year, month, 1);
    const lastDayOfMonth = new Date(year, month + 1, 0);
    const numDaysInMonth = lastDayOfMonth.getDate();

    let firstDayOfWeek = firstDayOfMonth.getDay();
    firstDayOfWeek = (firstDayOfWeek === 0) ? 6 : firstDayOfWeek - 1;

    const prevMonthLastDay = new Date(year, month, 0).getDate();
    for (let i = firstDayOfWeek; i > 0; i--) {
      const div = document.createElement('div');
      div.classList.add('day', 'other-month');
      div.textContent = prevMonthLastDay - i + 1;
      calendarGrid.appendChild(div);
    }

    for (let i = 1; i <= numDaysInMonth; i++) {
      const div = document.createElement('div');
      div.classList.add('day');
      div.textContent = i;
      const currentDay = new Date(year, month, i);

      if (currentDay.toDateString() === new Date().toDateString()) {
        div.classList.add('today');
      }

      const isHoliday = chileanHolidays.some(holiday =>
        holiday.month === month && holiday.day === i
      );
      if (isHoliday) {
        div.classList.add('holiday');
        const indicator = document.createElement('span');
        indicator.classList.add('event-indicator');
        indicator.textContent = 'Feriado';
        div.appendChild(indicator);
      }

      div.addEventListener('click', () => {
        div.classList.toggle('selected');
        updateSelectedDays();
      });

      calendarGrid.appendChild(div);
    }

    const totalDaysDisplayed = firstDayOfWeek + numDaysInMonth;
    const remainingDays = 42 - totalDaysDisplayed;
    for (let i = 1; i <= remainingDays; i++) {
      if (totalDaysDisplayed + i > 35 && totalDaysDisplayed + i <= 42) {
        const div = document.createElement('div');
        div.classList.add('day', 'other-month');
        div.textContent = i;
        calendarGrid.appendChild(div);
      }
    }
  }

  function updateSelectedDays() {
    selectedDays = Array.from(document.querySelectorAll('.day.selected')).map(d => parseInt(d.textContent));
    if (selectedDays.length > 0) {
      openModal();
    }
  }

  function openModal() {
    selectedDaysCount.textContent = selectedDays.length;
    modal.style.display = 'flex';
  }

  function closeModal() {
    modal.style.display = 'none';
  }

  async function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(16);
    doc.text("Solicitud de Permiso", 20, 20);

    doc.setFontSize(12);
    doc.text(`Nombre: Ruth Pérez`, 20, 30);
    doc.text(`RUT: 12.345.678-9`, 20, 40);
    doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 20, 50);
    doc.text(`Días seleccionados: ${selectedDays.join(', ')}`, 20, 60);
    doc.text(`Tipo de permiso: ${leaveTypeSelect.options[leaveTypeSelect.selectedIndex].text}`, 20, 70);

    doc.save("solicitud_permiso.pdf");
    closeModal();
  }

  showPage(loginPage);
</script>
</body>
</html>